<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ë‹¨ì¶•í‚¤ í€´ì¦ˆ - Design Skills Lab</title>

  <!-- PWA í•µì‹¬ -->
  <link rel="manifest" href="manifest.json" />
  <meta name="theme-color" content="#3e64ff" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="default" />
  <meta name="apple-mobile-web-app-title" content="ë‹¨ì¶•í‚¤ í€´ì¦ˆ" />
  <link rel="apple-touch-icon" href="icon-192.png" />

  <!-- Service Worker ë“±ë¡ -->
  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('sw.js');
      });
    }
  </script>

  <link rel="preconnect" href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/" crossorigin />
  <style>
    @import url('https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css');

    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      font-family: 'Pretendard', sans-serif;
      background: #f0f3fc;
      min-height: 100vh;
      padding: 24px 16px;
    }

    /* â”€â”€ ì „ì²´í™”ë©´ ìƒë‹¨ ë°” â”€â”€ */
    #fs-topbar {
      display: none;
      position: fixed;
      top: 0; left: 0; right: 0;
      height: 44px;
      background: rgba(255,255,255,0.92);
      backdrop-filter: blur(10px);
      border-bottom: 1px solid #e8ecf8;
      z-index: 500;
      align-items: center;
      justify-content: space-between;
      padding: 0 16px;
      gap: 12px;
    }
    #fs-topbar.visible { display: flex; }
    #fs-topbar .fs-hint {
      font-size: 12px;
      color: #888;
      display: flex;
      align-items: center;
      gap: 6px;
    }
    #fs-topbar .fs-hint kbd {
      background: #f0f3fc;
      border: 1px solid #d0d7f0;
      border-radius: 5px;
      padding: 1px 6px;
      font-size: 11px;
      font-family: 'Pretendard', sans-serif;
      color: #555;
    }
    #fs-exit-btn {
      background: none;
      border: 1px solid #ddd;
      border-radius: 8px;
      padding: 5px 12px;
      font-size: 12px;
      color: #555;
      cursor: pointer;
      font-family: 'Pretendard', sans-serif;
      display: flex;
      align-items: center;
      gap: 5px;
      white-space: nowrap;
      transition: all 0.2s;
    }
    #fs-exit-btn:hover { background: #f5f5f5; border-color: #bbb; }
    body.fullscreen-mode { padding-top: 56px; }

    /* â”€â”€ PWA ì„¤ì¹˜ ë°°ë„ˆ â”€â”€ */
    #pwa-banner {
      display: none;
      position: fixed;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: #3e64ff;
      color: white;
      padding: 12px 20px;
      border-radius: 14px;
      font-size: 14px;
      font-weight: 600;
      box-shadow: 0 4px 20px rgba(62,100,255,0.35);
      z-index: 9999;
      display: flex;
      align-items: center;
      gap: 12px;
      white-space: nowrap;
    }
    #pwa-banner.hidden { display: none !important; }
    #pwa-install-btn {
      background: white;
      color: #3e64ff;
      border: none;
      padding: 6px 14px;
      border-radius: 8px;
      font-size: 13px;
      font-weight: 700;
      cursor: pointer;
    }
    #pwa-dismiss-btn {
      background: none;
      border: none;
      color: rgba(255,255,255,0.7);
      font-size: 18px;
      cursor: pointer;
      line-height: 1;
    }

    /* â”€â”€ ì „ì²´í™”ë©´ ì•ˆë‚´ ì˜¤ë²„ë ˆì´ â”€â”€ */
    #fullscreen-overlay {
      position: fixed;
      inset: 0;
      background: linear-gradient(135deg, #0f1535 0%, #1a2560 60%, #0d1030 100%);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 10000;
      gap: 0;
    }
    #fullscreen-overlay.hidden { display: none; }
    .overlay-card {
      background: rgba(255,255,255,0.06);
      border: 1px solid rgba(255,255,255,0.12);
      border-radius: 24px;
      padding: 48px 52px;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 16px;
      max-width: 460px;
      width: 90%;
      backdrop-filter: blur(12px);
    }
    .overlay-icon { font-size: 52px; line-height: 1; }
    #fullscreen-overlay h2 {
      color: white;
      font-size: 24px;
      font-weight: 800;
      text-align: center;
      letter-spacing: -0.5px;
    }
    #fullscreen-overlay p {
      color: rgba(255,255,255,0.6);
      font-size: 14px;
      text-align: center;
      line-height: 1.7;
    }
    .overlay-divider {
      width: 100%;
      height: 1px;
      background: rgba(255,255,255,0.1);
      margin: 4px 0;
    }
    .overlay-keys {
      display: flex;
      gap: 8px;
      align-items: center;
      flex-wrap: wrap;
      justify-content: center;
    }
    .overlay-key {
      background: rgba(255,255,255,0.1);
      border: 1px solid rgba(255,255,255,0.2);
      border-radius: 8px;
      padding: 4px 10px;
      font-size: 12px;
      color: rgba(255,255,255,0.8);
      font-family: 'Pretendard', sans-serif;
    }
    .overlay-key-label {
      font-size: 12px;
      color: rgba(255,255,255,0.45);
    }
    #fullscreen-overlay .overlay-btns {
      display: flex;
      gap: 10px;
      margin-top: 8px;
      width: 100%;
    }
    .overlay-btn-primary {
      flex: 1;
      background: #3e64ff;
      color: white;
      border: none;
      padding: 14px 20px;
      border-radius: 12px;
      font-size: 15px;
      font-weight: 700;
      cursor: pointer;
      font-family: 'Pretendard', sans-serif;
      transition: background 0.2s;
    }
    .overlay-btn-primary:hover { background: #2d52ee; }
    .overlay-btn-secondary {
      background: rgba(255,255,255,0.08);
      color: rgba(255,255,255,0.7);
      border: 1px solid rgba(255,255,255,0.15);
      padding: 14px 20px;
      border-radius: 12px;
      font-size: 14px;
      cursor: pointer;
      font-family: 'Pretendard', sans-serif;
      transition: background 0.2s;
      white-space: nowrap;
    }
    .overlay-btn-secondary:hover { background: rgba(255,255,255,0.13); }

    /* â”€â”€ ê¸°ì¡´ ìŠ¤íƒ€ì¼ (ì•„ì„ì›¹ì—ì„œ ì´ì‹) â”€â”€ */
    .ds-container {
      display: flex;
      max-width: 1200px;
      margin: 0 auto;
      gap: 24px;
    }
    .ds-left {
      width: 240px;
      height: 707px;
      background: white;
      border-radius: 20px;
      overflow: hidden;
      display: flex;
      flex-direction: column;
    }
    .ds-left .ds-panel {
      flex: 1;
      overflow-y: auto;
      background: white;
      scrollbar-width: thin;
      scrollbar-color: transparent transparent;
    }
    .ds-left .ds-panel::-webkit-scrollbar { width: 4px; }
    .ds-left .ds-panel::-webkit-scrollbar-track { background: transparent; }
    .ds-left .ds-panel::-webkit-scrollbar-thumb { background-color: transparent; border-radius: 8px; }
    .ds-left .ds-panel:hover::-webkit-scrollbar-thumb { background-color: rgba(0,0,0,0.15); }
    .ds-left .ds-panel > *:first-child { margin-top: 1px; }
    .ds-left .ds-panel > *:last-child { margin-bottom: 8px; }
    .ds-right-area { flex: 1; display: flex; flex-direction: column; gap: 24px; }
    .ds-top-row, .ds-bottom-row { display: flex; gap: 24px; }
    .ds-top-row .ds-panel:first-child { flex: 2; min-height: 450px; }
    .ds-top-row .ds-panel:last-child { flex: 1; min-height: 450px; }
    .ds-bottom-row .ds-panel:first-child { flex: 1.5; }
    .ds-bottom-row .ds-panel:last-child { flex: 1; }
    .ds-panel {
      background: white;
      border-radius: 20px;
      padding: 20px;
      display: flex;
      flex-direction: column;
      position: relative;
    }
    .ds-tool-selector { position: relative; padding: 0px 16px; margin-top: -20px; }
    .ds-tool-btn {
      font-family: 'Pretendard', sans-serif;
      background: none; border: none;
      font-size: 15px; font-weight: 700;
      display: flex; align-items: center; gap: 8px;
      cursor: pointer; padding: 8px 0; border-radius: 12px; width: 100%;
    }
    .ds-arrow-icon { margin-left: auto; width: 16px; height: 16px; }
    .ds-tool-dropdown {
      position: absolute; top: 100%; left: 0; width: 200px;
      background: white; border: 1px solid #dbe0f5; border-radius: 14px;
      box-shadow: 0 8px 20px rgba(0,0,0,0.08); overflow: hidden;
      max-height: 0; opacity: 0;
      transition: max-height 0.3s ease, opacity 0.2s ease;
      pointer-events: none; z-index: 100; padding-left: 0;
      margin-top: -43px; margin-left: -1px;
    }
    .ds-tool-dropdown.show { max-height: 500px; opacity: 1; pointer-events: auto; }
    .ds-tool-dropdown li {
      font-family: 'Pretendard', sans-serif;
      display: flex; align-items: center; gap: 8px;
      padding: 10px 16px; font-size: 15px; cursor: pointer;
      transition: background 0.2s ease; list-style: none;
    }
    .ds-tool-dropdown li:hover { background-color: #f3f6ff; }
    .ds-tool-dropdown li.selected { font-weight: bold; pointer-events: none; background-color: #f8faff; }
    .ds-tool-dropdown .ds-divider { height: 1px; background-color: #eee; margin: 4px 0; }
    .ds-tool-icon { width: 22px; height: 22px; border-radius: 6px; }
    .ds-tool-close {
      text-align: right; padding: 8px 12px 4px; font-size: 14px;
      cursor: pointer; color: #999; font-weight: bold;
      transition: color 0.2s ease; position: absolute; right: 0; top: 6px; margin-right: 4.5px;
    }
    .ds-tool-close:hover { color: #555; }
    #ds-main-categories::before {
      content: ""; display: block; height: 1px;
      background-color: #e2e6f3; margin: 16px 0;
    }
    .ds-top-category { display: flex; flex-direction: column; gap: 4px; }
    .ds-sub-category { display: flex; flex-direction: column; gap: 3px; }
    #ds-sub-categories::before {
      content: ""; display: block; height: 1px;
      background-color: #ddd; margin: 8px 0px 12px 0px;
    }
    .ds-topcat-btn {
      background: none; border-radius: 12px; padding: 10px 12px;
      border: none; cursor: pointer; display: flex; flex-direction: column;
      transition: background 0.2s ease; text-align: left;
    }
    .ds-topcat-btn.active { background: #edf2ff; color: #000; }
    .ds-topcat-btn .topcat-label { display: flex; justify-content: space-between; align-items: center; }
    .ds-topcat-btn .title { font-family: 'Pretendard', sans-serif; font-size: 13px; line-height: 1.3; font-weight: 700; }
    .ds-topcat-btn .badge { font-family: 'Pretendard', sans-serif; font-size: 12px; color: #FF2B00; font-weight: 500; background: none; padding: 0; }
    .ds-topcat-count { font-size: 12px; color: #888; margin-left: 2px; line-height: 1.2; }
    .ds-subcat-btn {
      background: none; border-radius: 8px; padding: 6px 20px;
      border: none; cursor: pointer; display: flex; transition: background 0.2s ease; text-align: left;
    }
    .ds-subcat-btn.active { background: #edf2ff; color: #000; }
    .ds-subcat-btn .subcat-label { display: flex; flex-direction: column; align-items: flex-start; gap: 4px; }
    .icon-title-wrapper { display: flex; align-items: center; gap: 6px; }
    .ds-subcat-btn .icon { display: inline-flex; width: 22px; height: 22px; font-size: 14px; color: #333; }
    .ds-subcat-btn .title { font-family: 'Pretendard', sans-serif; font-size: 12px; line-height: 1.3; }
    .subcat-count { font-size: 11px; color: #888; line-height: 1.2; }
    .ds-answer-footer {
      display: flex; justify-content: space-between; align-items: center;
      padding: 12px 0; margin-top: auto; border-top: 1px solid #eee;
    }
    .ds-answer-btn {
      flex: 1; font-size: 14px; padding: 12px 0;
      background: transparent; border: none; cursor: pointer;
      transition: background 0.2s ease; font-family: 'Pretendard', sans-serif;
    }
    .ds-answer-btn.left { border-right: 1px solid #eee; }
    .ds-answer-btn:hover { background-color: #f5f5f5; }
    .ds-keyboard-panel, .ds-progress-panel { height: 220px; }
    .ds-panel.ds-panel-question { padding: 20px 35px 2px 35px !important; }
    .ds-panel-question .ds-answer-footer { padding: 4px 0; margin-top: auto; border-top: 1px solid #eee; }
    .ds-panel-question .ds-answer-btn { flex: 1; font-size: 13px; padding: 8px 0; background: transparent; border: none; cursor: pointer; transition: background 0.2s ease; font-family: 'Pretendard', sans-serif; }
    .ds-panel-question .ds-answer-btn.left { border-right: 1px solid #eee; }
    .ds-panel-question .ds-answer-btn:hover { background-color: #f5f5f5; }
    #ds-keyboard-hint {
      font-family: 'Pretendard', sans-serif;
      position: absolute; bottom: 16px; left: 0;
      width: 100%; text-align: center; font-size: 13px; color: #777;
    }
    .ds-shortcut__top { display: flex; justify-content: space-between; align-items: center; }
    #ds-command { font-family: 'Pretendard', sans-serif; font-size: 28px; font-weight: 800; }
    #ds-desc { font-family: 'Pretendard', sans-serif; color: #444; font-size: 14px; }
    #ds-link { font-family: 'Pretendard', sans-serif; font-weight: 500; margin-top: -30px; margin-right: -15px; }
    #ds-preview {
      width: 380px; height: 260px; position: absolute;
      bottom: 60px; right: 53px; background: #aaa; border-radius: 10px;
    }
    .ds-keyboard-header { display: flex; justify-content: space-between; align-items: center; font-weight: bold; }
    .ds-keyboard-buttons-wrapper { display: flex; justify-content: space-between; align-items: center; gap: 16px; padding: 20px 10px 0; }
    .ds-keyboard-column { display: flex; flex-direction: column; gap: 12px; }
    .ds-keyboard-button-row { display: flex; gap: 12px; }
    .ds-divider { width: 1.4px; height: 100%; background-color: #eee; margin: 0 20px; }
    .ds-keyboard-title { font-family: 'Pretendard', sans-serif; font-weight: 700; font-size: 14px; }
    .ds-key-btn {
      font-size: 16px; padding: 8px 16px; border-radius: 12px;
      background: #fff; border: 2px solid #ccc;
      box-shadow: 0 2px 4px rgba(0,0,0,0.04);
      transition: all 0.2s ease; min-width: 64px; min-height: 46px;
      cursor: pointer; font-family: 'Pretendard', sans-serif;
    }
    .ds-key-btn.active { background: #dce3ff; color: #305aff; border-color: #b7c6ff; font-weight: 600; }
    .btn-size-shift { min-width: 140px !important; }
    .btn-size-ctrl { min-width: 80px !important; }
    .btn-size-alt { min-width: 70px !important; margin-left: 20px; }
    .ds-keyboard-display {
      width: 80px; height: 80px; background: white;
      border: 2px solid #ccc; border-radius: 12px;
      display: flex; align-items: center; justify-content: center;
      font-size: 28px; font-weight: bold;
      box-shadow: 0 2px 4px rgba(0,0,0,0.05);
    }
    .ds-toggle-btn { font-size: 13px; padding: 6px 12px; border-radius: 8px; border: 1px solid #3e64ff; background: white; color: #3e64ff; cursor: pointer; }
    .ds-link { font-size: 13px; color: #3e64ff; text-decoration: none; }
    .ds-progress-panel h4 { font-family: 'Pretendard', sans-serif; font-weight: 700; font-size: 14px; margin: 0 0 4px; }
    #ds-progress-label { font-size: 11px; color: #888; margin-bottom: 2px; }
    .ds-progress-ring { position: relative; width: 120px; height: 120px; margin: 2px auto; }
    .ds-progress-ring svg { width: 120px; height: 120px; transform: rotate(-90deg); }
    .ds-progress-ring circle { fill: none; stroke-width: 10; }
    .ds-progress-ring .bg { stroke: #DDE5F3; }
    .ds-progress-ring .progress { stroke: #3e64ff; stroke-linecap: round; stroke-dasharray: 314; stroke-dashoffset: 314; transition: stroke-dashoffset 0.6s ease; }
    #ds-progress-count { font-family: 'Pretendard', sans-serif; font-weight: 200; margin-top: 2px; }
    #ds-progress-percent { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-size: 20px; font-weight: bold; }
    .ds-os-toggle { font-family: 'Pretendard', sans-serif; font-weight: 300; font-size: 13px; color: #555; cursor: pointer; user-select: none; padding: 2px 8px; border-radius: 8px; transition: background 0.2s ease; }
    .ds-os-toggle:hover { background: #f0f0f0; }
    #ds-keyboard-display.correct { background-color: #d4edda; transition: background-color 0.3s, border-color 0.3s; }
    #ds-keyboard-display.incorrect { background-color: #f8d7da; transition: background-color 0.3s, border-color 0.3s; }
    .ds-keyboard-panel.locked { outline: 4px solid #F17878; outline-offset: -2px; border: none; border-radius: 20px; }
    /* ì˜¤ë‹µ: íŒ¨ë„ ì „ì²´ ë¹¨ê°„ í…Œë‘ë¦¬ */
    .ds-keyboard-panel.panel-incorrect {
      outline: 3px solid #F17878;
      outline-offset: -2px;
      border-radius: 20px;
    }
    /* ì •ë‹µ: íŒ¨ë„ ì „ì²´ ì´ˆë¡ í…Œë‘ë¦¬ */
    .ds-keyboard-panel.panel-correct {
      outline: 3px solid #4caf7d;
      outline-offset: -2px;
      border-radius: 20px;
    }
    @keyframes shake { 0% { transform: translateX(0); } 20% { transform: translateX(-6px); } 40% { transform: translateX(6px); } 60% { transform: translateX(-4px); } 80% { transform: translateX(4px); } 100% { transform: translateX(0); } }
    .ds-keyboard-panel.shake { animation: shake 0.4s ease-in-out; }
    .ds-keyboard-panel.locked.shake { animation: shake 0.3s ease-in-out; }
    @keyframes highlightFade { 0% { box-shadow: 0 0 0 4px #F17878; } 100% { box-shadow: 0 0 0 0 rgba(48,90,255,0); } }
    .ds-keyboard-panel.highlight { animation: highlightFade 1.8s ease-out, shake 0.3s ease-in-out; }
    .ds-key-btn.highlight, #ds-keyboard-display.highlight { box-shadow: 0 0 0 2px #b7c6ff; transition: box-shadow 0.3s ease; }
    .ds-answer-btn.right.gradient-animate { position: relative; overflow: hidden; font-weight: bold; border-radius: 3px; }
    .ds-answer-btn.right.gradient-animate::after { content: ""; position: absolute; top: 10%; width: 40%; height: 80%; background: linear-gradient(to right, rgba(255,255,255,0) 0%, rgba(62,100,255,0.25) 50%, rgba(255,255,255,0) 100%); border-radius: 20px; filter: blur(8px); animation: slideLight 1.8s ease-in-out infinite; pointer-events: none; }
    @keyframes slideLight { 0% { left: -40%; } 100% { left: 110%; } }
    .ds-version-text { text-align: center; font-size: 10px; color: #888; padding: 12px 0; cursor: pointer; margin-top: auto; font-family: 'Pretendard', sans-serif; }
    .ds-version-popup { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(33,33,33,0.5); display: flex; justify-content: center; align-items: center; z-index: 999; }
    .ds-version-popup.hidden { display: none; }
    .ds-version-popup-content { background: white; border-radius: 16px; padding: 24px 20px; width: 90%; max-width: 460px; box-shadow: 0 8px 24px rgba(0,0,0,0.15); position: relative; font-family: 'Pretendard', sans-serif; }
    .ds-popup-header { display: flex; justify-content: space-between; align-items: center; font-weight: bold; font-size: 16px; margin-bottom: 12px; }
    .ds-popup-close { border: none; background: none; font-size: 18px; color: #888; cursor: pointer; transition: color 0.2s; }
    .ds-popup-close:hover { color: #444; }
    .ds-popup-body { font-size: 14px; line-height: 1.6; color: #333; }
    .ds-tool-toggle-btn { display: none; }
    .ds-tool-toggle-btn svg { transition: transform 0.3s ease; }
    .ds-tool-toggle-btn.active svg { transform: rotate(180deg); }

    /* â”€â”€ ë°˜ì‘í˜• â”€â”€ */
    @media (max-width: 768px) {
      .ds-container { flex-direction: column; padding: 0 12px; }
      .ds-left { display: none; }
      .ds-keyboard-panel { display: flex !important; height: auto; min-height: 160px; }
      .ds-progress-panel { display: none; }
      .ds-left.mobile-open { display: block; width: 100%; height: auto; margin-bottom: 12px; }
      .ds-tool-toggle-btn { display: flex; justify-content: space-between; align-items: center; background: #ffffff; padding: 12px 16px; border-radius: 12px; font-weight: 600; font-size: 15px; cursor: pointer; font-family: 'Pretendard', sans-serif; margin: -30px 12px 12px; }
      #ds-link { margin-right: 5px; }
      .ds-tool-dropdown { width: 100%; }
      .ds-right-area { width: 100%; }
      /* ëª¨ë°”ì¼ í‚¤ë³´ë“œ íŒ¨ë„ ë ˆì´ì•„ì›ƒ */
      .ds-keyboard-buttons-wrapper { padding: 12px 6px 0; gap: 10px; }
      .ds-key-btn { min-width: 52px !important; min-height: 40px; font-size: 14px; padding: 6px 10px; }
      .btn-size-shift { min-width: 110px !important; }
      .btn-size-ctrl { min-width: 60px !important; }
      .btn-size-alt { min-width: 52px !important; margin-left: 10px; }
      .ds-keyboard-display { width: 64px; height: 64px; font-size: 22px; }
      #ds-keyboard-hint { position: static; margin-top: 10px; padding-bottom: 8px; font-size: 12px; }
    }
    @media (max-width: 768px) {
      .ds-top-row { flex-direction: column; }
      .ds-panel.ds-panel-question { min-height: unset; padding: 20px 16px 4px !important; border-radius: 16px; }
      #ds-preview { position: static; display: block; width: 100%; height: auto; max-width: 100%; margin-top: 16px; border-radius: 8px; aspect-ratio: 400 / 260; }
      .ds-answer-footer { flex-direction: column; gap: 8px; margin-top: 20px; }
      .ds-answer-btn { width: 100%; border-right: none !important; border-top: 1px solid #eee; padding: 12px 0; }
    }
    @media (max-width: 980px) {
      #ds-preview { position: static; display: block; margin: 16px auto 0; max-width: 100%; height: auto; aspect-ratio: 400 / 260; }
    }
  </style>
</head>
<body>

<!-- ì „ì²´í™”ë©´ ìƒë‹¨ë°” -->
<div id="fs-topbar">
  <div class="fs-hint">
    <kbd>Ctrl</kbd><kbd>Shift</kbd><kbd>Alt</kbd> ì¡°í•© í›„ ë¬¸ì í‚¤ ì…ë ¥
    &nbsp;|&nbsp; ì°¨ë‹¨ëœ ë‹¨ì¶•í‚¤: <kbd>Ctrl+W</kbd> <kbd>Ctrl+T</kbd> <kbd>Ctrl+R</kbd> ë“±
  </div>
  <button id="fs-exit-btn" onclick="exitFullscreen()">
    â›¶ ì „ì²´í™”ë©´ ë‚˜ê°€ê¸°
  </button>
</div>

<!-- ì „ì²´í™”ë©´ ì•ˆë‚´ ì˜¤ë²„ë ˆì´ -->
<div id="fullscreen-overlay">
  <div class="overlay-card">
    <div class="overlay-icon">âŒ¨ï¸</div>
    <h2>ì „ì²´í™”ë©´ ëª¨ë“œ ê¶Œì¥</h2>
    <p>ì „ì²´í™”ë©´ì—ì„œëŠ” Ctrl+W, Ctrl+T ë“±<br>ë¸Œë¼ìš°ì € ë‹¨ì¶•í‚¤ê°€ ì™„ì „íˆ ì°¨ë‹¨ë¼ìš”.</p>
    <div class="overlay-divider"></div>
    <div class="overlay-keys">
      <span class="overlay-key-label">ì°¨ë‹¨ë˜ëŠ” í‚¤:</span>
      <span class="overlay-key">Ctrl+W</span>
      <span class="overlay-key">Ctrl+T</span>
      <span class="overlay-key">Ctrl+R</span>
      <span class="overlay-key">Ctrl+F</span>
      <span class="overlay-key">Ctrl+P</span>
    </div>
    <div class="overlay-btns">
      <button class="overlay-btn-primary" onclick="enterFullscreen()">ğŸ–¥ ì „ì²´í™”ë©´ìœ¼ë¡œ ì‹œì‘</button>
      <button class="overlay-btn-secondary" onclick="skipFullscreen()">ê·¸ëƒ¥ ê³„ì†</button>
    </div>
  </div>
</div>

<!-- PWA ì„¤ì¹˜ ë°°ë„ˆ -->
<div id="pwa-banner" class="hidden">
  <span>ğŸ“² ì•±ìœ¼ë¡œ ì„¤ì¹˜í•˜ë©´ ë” í¸í•´ìš”!</span>
  <button id="pwa-install-btn">ì„¤ì¹˜í•˜ê¸°</button>
  <button id="pwa-dismiss-btn" onclick="dismissPWA()">âœ•</button>
</div>

<!-- ëª¨ë°”ì¼ ì¹´í…Œê³ ë¦¬ í† ê¸€ -->
<div class="ds-tool-toggle-btn" onclick="toggleMobileCategories()">
  ì¹´í…Œê³ ë¦¬ ë³´ê¸°
  <svg id="ds-category-arrow" width="16" height="16" fill="none" stroke="#333" stroke-width="2" viewBox="0 0 24 24">
    <path d="M6 9l6 6 6-6"/>
  </svg>
</div>

<div class="ds-container">
  <div class="ds-left">
    <div class="ds-panel">
      <div class="ds-tool-selector">
        <button class="ds-tool-btn" onclick="toggleToolDropdown()">
          <img id="selected-tool-icon" src="https://cdn.imweb.me/upload/S20190713161f9b85458b3/2f0361160b913.png" class="ds-tool-icon" />
          <span id="selected-tool-name">Photoshop</span>
          <svg class="ds-arrow-icon" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="#666" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <polyline points="6 9 12 15 18 9" />
          </svg>
        </button>
        <ul id="tool-dropdown" class="ds-tool-dropdown"></ul>
      </div>
      <div id="ds-main-categories" class="ds-top-category"></div>
      <div id="ds-sub-categories" class="ds-sub-category"></div>
    </div>
    <div id="ds-version-info" class="ds-version-text" onclick="openVersionPopup()">v1.1.0 PWA</div>
    <div id="ds-version-popup" class="ds-version-popup hidden" onclick="closeVersionPopupByBackdrop(event)">
      <div class="ds-version-popup-content">
        <div class="ds-popup-header">
          <span>ë²„ì „ ì •ë³´</span>
          <button class="ds-popup-close" onclick="closeVersionPopup()">âœ•</button>
        </div>
        <div class="ds-popup-body">
          <p><strong>v1.1.0 PWA</strong> - ë¸Œë¼ìš°ì € ë‹¨ì¶•í‚¤ ì¶©ëŒ í•´ê²° ë²„ì „<br>
             ì „ì²´í™”ë©´ ëª¨ë“œì—ì„œ Ctrl+W, Ctrl+T ë“±ì˜ ì¶©ëŒ ì—†ì´ ëª¨ë“  ë‹¨ì¶•í‚¤ í•™ìŠµ ê°€ëŠ¥<br>
             ë²„ê·¸ ë¦¬í¬íŠ¸: designskillslab@gmail.com</p>
          <hr style="margin: 12px 0;">
          <p><strong>[ê³µì§€ì‚¬í•­]</strong><br>
             ì´ ì„œë¹„ìŠ¤ëŠ” ë””ìì¸ ìŠ¤í‚¬ ë©ì˜ ìì‚°ì´ë¯€ë¡œ ë¬´ë‹¨ ë³µì œ, ë°°í¬ë¥¼ ê¸ˆì§€í•©ë‹ˆë‹¤.</p>
        </div>
      </div>
    </div>
  </div>

  <div class="ds-right-area">
    <div class="ds-top-row">
      <div class="ds-panel ds-panel-question">
        <div class="ds-shortcut__top">
          <div id="ds-command">ë¬¸ì œ ì œëª© ì˜ˆì‹œ</div>
          <a id="ds-link" class="ds-link" href="#" target="_blank" style="display: none;">ë” ì•Œì•„ë³´ê¸°</a>
        </div>
        <div id="ds-desc">í•´ë‹¹ ê¸°ëŠ¥ì— ëŒ€í•œ ì„¤ëª…ì´ ì´ê³³ì— ë“¤ì–´ê°‘ë‹ˆë‹¤.</div>
        <img id="ds-preview" src="" alt="Preview" />
        <div class="ds-answer-footer">
          <button class="ds-answer-btn left" onclick="showAnswer()">ì •ë‹µ ë³´ê¸°</button>
          <button class="ds-answer-btn right" onclick="skipQuestion()">ë‹¤ìŒ</button>
        </div>
      </div>
      <!-- ê´‘ê³  ì˜ì—­ (PWA ë²„ì „ì—ì„œëŠ” ì„ íƒì ) -->
      <div class="ds-panel" style="flex:1; min-height:450px; display:flex; align-items:center; justify-content:center; color:#ccc; font-size:13px;">
        ê´‘ê³  ì˜ì—­
      </div>
    </div>

    <div class="ds-bottom-row">
      <div class="ds-panel ds-keyboard-panel">
        <div class="ds-keyboard-header">
          <span class="ds-keyboard-title">Keyboard</span>
          <div>
            <span id="ds-os-mode" class="ds-os-toggle">Win</span>
          </div>
        </div>
        <div class="ds-keyboard-buttons-wrapper">
          <div class="ds-keyboard-column" id="ds-keyboard-buttons">
            <div class="ds-keyboard-button-row">
              <button class="ds-key-btn btn-size-shift" id="btn-shift" data-key="shift">Shift</button>
            </div>
            <div class="ds-keyboard-button-row" id="ds-bottom-row">
              <button class="ds-key-btn btn-size-ctrl" id="btn-ctrl" data-key="control">Ctrl</button>
              <button class="ds-key-btn btn-size-alt" id="btn-alt" data-key="alt">Alt</button>
            </div>
          </div>
          <div class="ds-divider"></div>
          <div id="ds-keyboard-display" class="ds-keyboard-display">?</div>
        </div>
        <div id="ds-keyboard-hint" class="ds-keyboard-hint">
          ì¡°í•©í˜• ë‹¨ì¶•í‚¤ëŠ” ë²„íŠ¼ì„ í´ë¦­í•œ í›„ í‚¤ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.
        </div>
      </div>

      <div class="ds-panel ds-progress-panel">
        <h4>Progress</h4>
        <p id="ds-progress-label">ìì£¼ì“°ëŠ” ë‹¨ì¶•í‚¤</p>
        <div class="ds-progress-ring">
          <svg viewBox="0 0 120 120">
            <circle class="bg" cx="60" cy="60" r="50" />
            <circle class="progress" cx="60" cy="60" r="50" />
          </svg>
          <span id="ds-progress-percent">0%</span>
        </div>
        <div id="ds-progress-count" style="font-size:14px;color:#555;text-align:center;">0/0</div>
      </div>
    </div>
  </div>
</div>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ğŸ”‘ ë¸Œë¼ìš°ì € ë‹¨ì¶•í‚¤ ì°¨ë‹¨ (preventDefaultë§Œ, stopPropagation ì œê±°)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
document.addEventListener('keydown', function(e) {
  const key = e.key.toLowerCase();
  const isFKey = /^f\d+$/.test(key); // f1, f2 ... f12
  
  // Ctrl/Alt/Meta ì¡°í•©ì€ í•­ìƒ ì°¨ë‹¨
  if (e.ctrlKey || e.altKey || e.metaKey) {
    e.preventDefault();
    return;
  }
  
  // âœ… Shift+F5ëŠ” ë¸Œë¼ìš°ì € ê°•ì œ ìƒˆë¡œê³ ì¹¨ì´ë¯€ë¡œ ì°¨ë‹¨í•˜ë˜, í€´ì¦ˆ ë¡œì§ìœ¼ë¡œëŠ” ì „ë‹¬
  // preventDefaultë§Œ í•˜ê³  ì´ë²¤íŠ¸ëŠ” ê³„ì† ì „íŒŒ (stopPropagation ì—†ìŒ)
  if (isFKey) {
    e.preventDefault(); // ë¸Œë¼ìš°ì € ê¸°ë³¸ ë™ì‘ë§Œ ì°¨ë‹¨
  }
}, true);

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ì „ì²´í™”ë©´ ê´€ë ¨
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function enterFullscreen() {
  const el = document.documentElement;
  if (el.requestFullscreen) el.requestFullscreen();
  else if (el.webkitRequestFullscreen) el.webkitRequestFullscreen();
  document.getElementById('fullscreen-overlay').classList.add('hidden');
}

function exitFullscreen() {
  if (document.exitFullscreen) document.exitFullscreen();
  else if (document.webkitExitFullscreen) document.webkitExitFullscreen();
}

function skipFullscreen() {
  document.getElementById('fullscreen-overlay').classList.add('hidden');
}

function updateFullscreenUI(isFs) {
  const topbar = document.getElementById('fs-topbar');
  if (isFs) {
    document.getElementById('fullscreen-overlay').classList.add('hidden');
    topbar.classList.add('visible');
    document.body.classList.add('fullscreen-mode');
  } else {
    topbar.classList.remove('visible');
    document.body.classList.remove('fullscreen-mode');
  }
}

document.addEventListener('fullscreenchange', () => updateFullscreenUI(!!document.fullscreenElement));
document.addEventListener('webkitfullscreenchange', () => updateFullscreenUI(!!document.webkitFullscreenElement));

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// PWA ì„¤ì¹˜ ë°°ë„ˆ
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let deferredPrompt;
window.addEventListener('beforeinstallprompt', (e) => {
  e.preventDefault();
  deferredPrompt = e;
  document.getElementById('pwa-banner').classList.remove('hidden');
});

document.getElementById('pwa-install-btn').addEventListener('click', async () => {
  if (!deferredPrompt) return;
  deferredPrompt.prompt();
  const { outcome } = await deferredPrompt.userChoice;
  deferredPrompt = null;
  document.getElementById('pwa-banner').classList.add('hidden');
});

function dismissPWA() {
  document.getElementById('pwa-banner').classList.add('hidden');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ê¸°ì¡´ í€´ì¦ˆ ë¡œì§ (ì›ë³¸ ê·¸ëŒ€ë¡œ)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let pressedKeys = new Set();
let correctAnswers = new Set();
let skippedAnswers = new Set();
let allProblems = [];
let filteredProblems = [];
let currentProblem = null;
let selectedMain = null;
let selectedSubcats = new Set();
let categoryCounts = {};
let totalQuestionCount = 0;
let osMode = "win";
let isAnswerShown = false;
let isInputLocked = false;

const restrictedKeys = new Set([
  "tab", "capslock", "contextmenu", "backspace", "escape", "home", "end", "pagedown", "pageup",
  "enter", "delete", "arrowup", "arrowdown", "arrowleft", "arrowright"
  // F1~F12ëŠ” ì œê±° - ë‹¨ì¶•í‚¤ ë¬¸ì œë¡œ ì‚¬ìš© ê°€ëŠ¥í•˜ë„ë¡
]);

const topCategories = [
  { label: "ìì£¼ ì“°ëŠ” ë‹¨ì¶•í‚¤", value: "favorite" },
  { label: "All Shortcuts", value: "all" }
];

const iconMap = {
  toolbar: "https://cdn.imweb.me/upload/S20190713161f9b85458b3/52176a0448b5a.png",
  file: "https://cdn.imweb.me/upload/S20190713161f9b85458b3/1b26781514f2a.png",
  edit: "https://cdn.imweb.me/upload/S20190713161f9b85458b3/94261d545bd4f.png",
  image: "https://cdn.imweb.me/upload/S20190713161f9b85458b3/960f08147e155.png",
  layer: "https://cdn.imweb.me/upload/S20190713161f9b85458b3/1f9b14a9177f3.png",
  select: "https://cdn.imweb.me/upload/S20190713161f9b85458b3/8612a55fefa5b.png",
  selection: "https://cdn.imweb.me/upload/S20190713161f9b85458b3/8612a55fefa5b.png",
  filter: "https://cdn.imweb.me/upload/S20190713161f9b85458b3/1fa52067f64e0.png",
  view: "https://cdn.imweb.me/upload/S20190713161f9b85458b3/930774bc46e1f.png",
  window: "https://cdn.imweb.me/upload/S20190713161f9b85458b3/3bd70b2e92ec3.png",
  etc: "https://cdn.imweb.me/upload/S20190713161f9b85458b3/7bc607f00ce29.png",
  effect: "https://cdn.imweb.me/upload/S20190713161f9b85458b3/1fa52067f64e0.png",
  type: "https://cdn.imweb.me/upload/S20190713161f9b85458b3/d30fdd0446610.png",
  text: "https://cdn.imweb.me/upload/S20190713161f9b85458b3/d30fdd0446610.png",
  object: "https://cdn.imweb.me/upload/S20190713161f9b85458b3/d144f6638bb21.png",
  shape: "https://cdn.imweb.me/upload/S20190713161f9b85458b3/02cd9f7ab7f89.png",
  zoom: "https://cdn.imweb.me/upload/S20190713161f9b85458b3/67107f1dd55e0.png",
  transform: "https://cdn.imweb.me/upload/S20190713161f9b85458b3/ec00ab35e0ee2.png",
  arrange: "https://cdn.imweb.me/upload/S20190713161f9b85458b3/7e8a684a31a2a.png",
};

function normalizeKey(k) {
  const lower = k.toLowerCase();
  if (osMode === "mac" && lower === "meta") return "control";
  return lower;
}

function mapDisplayKey(k) {
  const lower = k.toLowerCase();
  if (osMode === "mac") {
    if (lower === "control" || lower === "meta") return "Cmd";
    if (lower === "alt") return "Option";
  } else {
    if (lower === "control") return "Ctrl";
  }
  return k.charAt(0).toUpperCase() + k.slice(1).toLowerCase();
}

async function loadProblems(jsonPath = "https://raw.githubusercontent.com/designskillslabdata/designslab/main/phshortcuts.json") {
  try {
    const res = await fetch(jsonPath);
    const rawData = await res.json();
    const data = rawData.shortcuts || rawData;
    const categoryOrder = rawData.categoryOrder || null;
    allProblems = data;
    categoryCounts = {};
    const categorySet = new Set();
    allProblems.forEach(p => {
      categoryCounts[p.category] = (categoryCounts[p.category] || 0) + 1;
      categorySet.add(p.category);
    });
    let sortedCategories;
    if (categoryOrder) {
      sortedCategories = categoryOrder.filter(cat => categorySet.has(cat));
    } else {
      sortedCategories = Array.from(categorySet).sort();
    }
    window.dynamicCategories = sortedCategories;
    renderCategoryButtons();
    document.querySelector(".ds-topcat-btn[data-main='favorite']")?.click();
  } catch (error) {
    console.error("ë¬¸ì œ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤:", error);
    alert("ë¬¸ì œë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.(ì¤€ë¹„ì¤‘)");
  }
}

function renderCategoryButtons() {
  const topContainer = document.getElementById("ds-main-categories");
  const subContainer = document.getElementById("ds-sub-categories");
  topContainer.innerHTML = "";
  subContainer.innerHTML = "";
  topCategories.forEach(cat => {
    const btn = document.createElement("button");
    btn.className = "ds-topcat-btn";
    btn.dataset.main = cat.value;
    let count = cat.value === "favorite"
      ? allProblems.filter(p => p.difficulty === "favorite").length
      : allProblems.length;
    btn.innerHTML = `
      <div class="topcat-label">
        <span class="title">${cat.label}</span>
        ${cat.value === "favorite" ? `<span class="badge">ì¶”ì²œ</span>` : ""}
      </div>
      <div class="ds-topcat-count">${count}</div>`;
    btn.addEventListener("click", () => {
      document.querySelectorAll(".ds-topcat-btn").forEach(b => b.classList.remove("active"));
      document.querySelectorAll(".ds-subcat-btn").forEach(b => b.classList.remove("active"));
      selectedSubcats.clear();
      selectedMain = cat.value;
      btn.classList.add("active");
      correctAnswers.clear();
      skippedAnswers.clear();
      applyFilters();
    });
    topContainer.appendChild(btn);
  });

  window.dynamicCategories.forEach(cat => {
    const btn = document.createElement("button");
    btn.className = "ds-subcat-btn";
    btn.dataset.cat = cat;
    const count = categoryCounts[cat] || 0;
    const iconURL = iconMap[cat] || "https://cdn.imweb.me/upload/S20190713161f9b85458b3/7bc607f00ce29.png";
    btn.innerHTML = `
      <div class="subcat-label">
        <div class="icon-title-wrapper">
          <img class="icon" src="${iconURL}" alt="${cat}" width="20" height="20" />
          <div>
            <div class="title">${cat.charAt(0).toUpperCase() + cat.slice(1)}</div>
            <div class="subcat-count">${count}</div>
          </div>
        </div>
      </div>`;
    btn.addEventListener("click", () => {
      document.querySelectorAll(".ds-topcat-btn").forEach(b => b.classList.remove("active"));
      selectedMain = null;
      if (selectedSubcats.has(cat)) {
        selectedSubcats.delete(cat);
        btn.classList.remove("active");
      } else {
        selectedSubcats.add(cat);
        btn.classList.add("active");
      }
      correctAnswers.clear();
      skippedAnswers.clear();
      applyFilters();
    });
    subContainer.appendChild(btn);
  });
}

function applyFilters() {
  filteredProblems = allProblems.filter(p => {
    const mainMatch = !selectedMain || selectedMain === 'all' || (selectedMain === 'favorite' && p.difficulty === 'favorite');
    const subMatch = selectedSubcats.size === 0 || selectedSubcats.has(p.category);
    return mainMatch && subMatch;
  });
  const labelEl = document.getElementById("ds-progress-label");
  if (selectedMain) {
    const selectedTop = topCategories.find(cat => cat.value === selectedMain);
    labelEl.textContent = selectedTop ? selectedTop.label : "";
  } else if (selectedSubcats.size > 0) {
    labelEl.textContent = Array.from(selectedSubcats).map(c => c.charAt(0).toUpperCase() + c.slice(1)).join(", ");
  } else {
    labelEl.textContent = "";
  }
  totalQuestionCount = filteredProblems.length;
  updateProgress(0, totalQuestionCount);
  currentProblem = null;
  if (filteredProblems.length > 0) {
    shuffleArray(filteredProblems);
    showProblem(filteredProblems.shift());
  } else {
    showProblem(null);
  }
}

function shuffleArray(array) {
  for (let i = array.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [array[i], array[j]] = [array[j], array[i]];
  }
}

function updateProgress(correct, total) {
  const percent = total > 0 ? Math.round((correct / total) * 100) : 0;
  const offset = 314 - (314 * percent) / 100;
  document.querySelector(".ds-progress-ring .progress").style.strokeDashoffset = offset;
  document.getElementById("ds-progress-percent").textContent = `${percent}%`;
  document.getElementById("ds-progress-count").textContent = `${correct}/${total}`;
}

function showProblem(problem) {
  isAnswerShown = false;
  currentProblem = problem;
  const commandEl = document.getElementById("ds-command");
  const descEl = document.getElementById("ds-desc");
  const previewEl = document.getElementById("ds-preview");
  const linkEl = document.getElementById("ds-link");
  const feedbackEl = document.getElementById("ds-keyboard-hint");
  const keyDisplayEl = document.getElementById("ds-keyboard-display");
  const keyboardPanel = document.querySelector(".ds-keyboard-panel");
  const answerBtn = document.querySelector(".ds-answer-btn.left");
  const answerNextBtn = document.querySelector(".ds-answer-btn.right");
  const mainPreview = "https://cdn.imweb.me/upload/S20190713161f9b85458b3/3e3d1e514ec0d.gif";
  const surprisePreviews = ["https://cdn.imweb.me/upload/S20190713161f9b85458b3/2833944b90bfa.gif"];

  pressedKeys.clear();
  document.querySelectorAll('.ds-key-btn').forEach(b => b.classList.remove("active", "highlight"));
  keyDisplayEl.classList.remove("highlight", "correct", "incorrect");
  keyDisplayEl.textContent = "?";

  if (!problem) {
    commandEl.textContent = "ë¬¸ì œê°€ ì—†ìŠµë‹ˆë‹¤";
    descEl.textContent = "ì„ íƒëœ ì¡°ê±´ì— ë§ëŠ” ë¬¸ì œê°€ ì—†ìŠµë‹ˆë‹¤.";
    feedbackEl.textContent = "";
    keyboardPanel.classList.remove("locked");
    linkEl.style.display = "none";
    if (answerBtn) answerBtn.textContent = "ì •ë‹µ ë³´ê¸°";
    return;
  }

  commandEl.textContent = problem.command;
  descEl.innerHTML = problem.description.replace(/\n/g, "<br>");
  const hasPreview = problem.preview && problem.preview !== "#";
  let previewFallback = mainPreview;
  if (Math.random() < 0.05) {
    const random = surprisePreviews[Math.floor(Math.random() * surprisePreviews.length)];
    previewFallback = random;
  }
  previewEl.src = hasPreview ? problem.preview : previewFallback;
  if (problem.link && problem.link !== "#") {
    linkEl.style.display = "inline";
    linkEl.href = problem.link;
  } else {
    linkEl.style.display = "none";
  }
  if (answerBtn) answerBtn.textContent = "ì •ë‹µ ë³´ê¸°";
  
  // âœ… preinput ë¡œì§ ì œê±° - ëª¨ë“  ë‹¨ì¶•í‚¤ ì •ìƒ ì…ë ¥ ê°€ëŠ¥
  feedbackEl.textContent = "ì¡°í•©í˜• ë‹¨ì¶•í‚¤ëŠ” ë²„íŠ¼ì„ í´ë¦­í•œ í›„ í‚¤ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.";
  keyboardPanel.classList.remove("locked");
  if (answerNextBtn) answerNextBtn.classList.remove("gradient-animate");
}

function indicateKeyResult(isCorrect) {
  const keyDisplay = document.getElementById("ds-keyboard-display");
  keyDisplay.classList.remove("correct", "incorrect");
  void keyDisplay.offsetWidth;
  if (isCorrect) {
    keyDisplay.classList.add("correct");
  } else {
    keyDisplay.classList.add("incorrect");
    setTimeout(() => keyDisplay.classList.remove("incorrect"), 800);
  }
}

function showAnswer() {
  if (!currentProblem || !currentProblem.shortcut) return;
  const answerText = currentProblem.shortcut.map(mapDisplayKey).join(" + ");
  const answerBtn = document.querySelector(".ds-answer-btn.left");
  if (!answerBtn) return;
  const keyDisplay = document.getElementById("ds-keyboard-display");
  if (!isAnswerShown) {
    answerBtn.textContent = answerText;
    isAnswerShown = true;
    pressedKeys.clear();
    document.querySelectorAll('.ds-key-btn').forEach(b => b.classList.remove("active", "highlight"));
    const modifiers = ["control", "shift", "alt", "meta"];
    currentProblem.shortcut.forEach(k => {
      const key = k.toLowerCase();
      let displayKey = key;
      if (osMode === "mac") {
        if (key === "control") displayKey = "meta";
      }
      if (modifiers.includes(key)) {
        const btn = document.querySelector(`.ds-key-btn[data-key='${displayKey}']`);
        if (btn) { btn.classList.add("active", "highlight"); pressedKeys.add(displayKey); }
      } else {
        keyDisplay.textContent = key.toUpperCase();
        keyDisplay.classList.add("highlight");
      }
    });
  } else {
    answerBtn.textContent = "ì •ë‹µ ë³´ê¸°";
    isAnswerShown = false;
    pressedKeys.clear();
    document.querySelectorAll('.ds-key-btn').forEach(b => b.classList.remove("active", "highlight"));
    keyDisplay.textContent = "?";
    keyDisplay.classList.remove("highlight");
  }
}

function checkAnswer() {
  if (!currentProblem || !currentProblem.shortcut || isInputLocked) return;
  const userInput = Array.from(pressedKeys).map(normalizeKey).sort();
  const answer = currentProblem.shortcut.map(k => k.toLowerCase()).sort();
  if (userInput.length < answer.length) return;
  const correct = JSON.stringify(userInput) === JSON.stringify(answer);

  const feedbackEl = document.getElementById("ds-keyboard-hint");
  const keyDisplay = document.getElementById("ds-keyboard-display");
  const keyboardPanel = document.querySelector(".ds-keyboard-panel");

  indicateKeyResult(correct);
  isInputLocked = true;

  if (correct) {
    feedbackEl.textContent = "ì •ë‹µì…ë‹ˆë‹¤! âœ“";
    correctAnswers.add(currentProblem.command);
    // íŒ¨ë„ ì „ì²´ ì´ˆë¡ í…Œë‘ë¦¬
    keyboardPanel.classList.add("panel-correct");
    setTimeout(() => {
      keyboardPanel.classList.remove("panel-correct");
      isInputLocked = false;
      pressedKeys.clear();
      document.querySelectorAll('.ds-key-btn').forEach(b => b.classList.remove("active"));
      showProblem(filteredProblems.shift() || null);
      updateProgress(correctAnswers.size + skippedAnswers.size, totalQuestionCount);
    }, 600);

  } else {
    feedbackEl.textContent = "ì˜¤ë‹µì…ë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ë³´ì„¸ìš”.";
    // âœ… íŒ¨ë„ ì „ì²´ ë¹¨ê°„ í…Œë‘ë¦¬ + ê°•í•œ í”ë“¤ë¦¼
    keyboardPanel.classList.add("panel-incorrect", "shake");
    setTimeout(() => {
      keyboardPanel.classList.remove("panel-incorrect", "shake");
      isInputLocked = false;
      keyDisplay.textContent = "?";
      keyDisplay.classList.remove("incorrect", "highlight");
      pressedKeys.clear();
      document.querySelectorAll('.ds-key-btn').forEach(b => b.classList.remove("active"));
    }, 600);
  }
}

function skipQuestion() {
  if (currentProblem) skippedAnswers.add(currentProblem.command);
  if (filteredProblems.length > 0) {
    showProblem(filteredProblems.shift());
  } else {
    showProblem(null);
  }
  updateProgress(correctAnswers.size + skippedAnswers.size, totalQuestionCount);
}

function toggleOSMode() {
  osMode = osMode === "win" ? "mac" : "win";
  updateKeyLabels();
  document.getElementById("ds-keyboard-hint").textContent = "ì¡°í•©í˜• ë‹¨ì¶•í‚¤ëŠ” ë²„íŠ¼ì„ í´ë¦­í•œ í›„ í‚¤ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.";
}

function updateKeyLabels() {
  const ctrlBtn = document.getElementById("btn-ctrl");
  const altBtn = document.getElementById("btn-alt");
  const osText = document.getElementById("ds-os-mode");
  const bottomRow = document.getElementById("ds-bottom-row");
  if (osMode === "mac") {
    ctrlBtn.textContent = "Cmd"; ctrlBtn.dataset.key = "meta";
    altBtn.textContent = "Option"; altBtn.dataset.key = "alt";
    osText.textContent = "Mac";
    bottomRow.innerHTML = "";
    bottomRow.appendChild(altBtn); bottomRow.appendChild(ctrlBtn);
  } else {
    ctrlBtn.textContent = "Ctrl"; ctrlBtn.dataset.key = "control";
    altBtn.textContent = "Alt"; altBtn.dataset.key = "alt";
    osText.textContent = "Win";
    bottomRow.innerHTML = "";
    bottomRow.appendChild(ctrlBtn); bottomRow.appendChild(altBtn);
  }
}

// â”€â”€ íˆ´ ë“œë¡­ë‹¤ìš´ â”€â”€
const toolData = [
  { name: "Photoshop", icon: "2f0361160b913.png", json: "phshortcuts.json" },
  { name: "Illustrator", icon: "1e977a9e6eb80.png", json: "aishortcuts.json" },
  { name: "Figma", icon: "5c72e082e7de0.png", json: "figmashortcuts.json" },
  { name: "Indesign", icon: "e6d4c565bf1f3.png", json: "idshortcuts.json" },
  { name: "Premiere Pro", icon: "a514e6630632a.png", json: "prshortcuts.json" },
  { name: "After Effects", icon: "354094f0ed8fd.png", json: "aeshortcuts.json" }
];
let currentTool = "Photoshop";

function toggleToolDropdown(forceClose = false) {
  const dropdown = document.getElementById("tool-dropdown");
  if (forceClose) { dropdown.classList.remove("show"); return; }
  const willOpen = !dropdown.classList.contains("show");
  if (willOpen) { dropdown.classList.add("show"); renderToolDropdown(); }
  else { dropdown.classList.remove("show"); }
}

document.addEventListener("click", (e) => {
  const dropdown = document.getElementById("tool-dropdown");
  const button = document.querySelector(".ds-tool-btn");
  if (!dropdown.contains(e.target) && !button.contains(e.target)) toggleToolDropdown(true);
}, true);

function renderToolDropdown() {
  const dropdown = document.getElementById("tool-dropdown");
  dropdown.innerHTML = "";
  const closeBtn = document.createElement("div");
  closeBtn.className = "ds-tool-close";
  closeBtn.innerHTML = "âœ•";
  closeBtn.onclick = () => toggleToolDropdown(true);
  dropdown.appendChild(closeBtn);
  const iconBase = "https://cdn.imweb.me/upload/S20190713161f9b85458b3/";
  const selectedTool = toolData.find(t => t.name === currentTool);
  const selected = document.createElement("li");
  selected.className = "selected";
  selected.innerHTML = `<img src="${iconBase + selectedTool.icon}" class="ds-tool-icon" /> ${selectedTool.name}`;
  selected.onclick = () => toggleToolDropdown(true);
  dropdown.appendChild(selected);
  const divider = document.createElement("div");
  divider.className = "ds-divider";
  dropdown.appendChild(divider);
  toolData.forEach(tool => {
    if (tool.name === currentTool) return;
    const li = document.createElement("li");
    li.innerHTML = `<img src="${iconBase + tool.icon}" class="ds-tool-icon" /> ${tool.name}`;
    li.onclick = () => selectTool(tool.name, tool.icon, tool.json);
    dropdown.appendChild(li);
  });
}

function selectTool(toolName, iconFile, jsonFile) {
  const iconPath = `https://cdn.imweb.me/upload/S20190713161f9b85458b3/${iconFile}`;
  const jsonPath = `https://raw.githubusercontent.com/designskillslabdata/designslab/main/${jsonFile}`;
  currentTool = toolName;
  document.getElementById("selected-tool-name").textContent = toolName;
  document.getElementById("selected-tool-icon").src = iconPath;
  document.getElementById("tool-dropdown").classList.remove("show");
  loadProblems(jsonPath);
}

function openVersionPopup() { document.getElementById("ds-version-popup").classList.remove("hidden"); }
function closeVersionPopup() { document.getElementById("ds-version-popup").classList.add("hidden"); }
function closeVersionPopupByBackdrop(e) { if (e.target.id === "ds-version-popup") closeVersionPopup(); }
function toggleMobileCategories() {
  const leftPanel = document.querySelector('.ds-left');
  const toggleBtn = document.querySelector('.ds-tool-toggle-btn');
  leftPanel.classList.toggle('mobile-open');
  toggleBtn.classList.toggle('active');
}

// â”€â”€ DOMContentLoaded â”€â”€
document.addEventListener("DOMContentLoaded", () => {
  updateKeyLabels();
  updateProgress(0, 0);
  loadProblems();

  document.querySelectorAll('.ds-key-btn').forEach(btn => {
    btn.addEventListener('click', () => {
      const key = btn.dataset.key.toLowerCase();
      if (pressedKeys.has(key)) { pressedKeys.delete(key); btn.classList.remove("active"); }
      else { pressedKeys.add(key); btn.classList.add("active"); }
      checkAnswer();
    });
  });

  // âœ… keydown: ìˆ˜ì‹í‚¤ ì‹¤ì‹œê°„ ë°˜ì˜ + ì¼ë°˜í‚¤ ì •ë‹µ ì²´í¬
  document.addEventListener("keydown", e => {
    if (isInputLocked) return;

    const key = e.key.toLowerCase();
    const keyboardPanel = document.querySelector(".ds-keyboard-panel");

    // Fí‚¤Â·ë°©í–¥í‚¤ ë“± ì™„ì „ ì°¨ë‹¨ í‚¤
    if (restrictedKeys.has(key)) {
      keyboardPanel.classList.add("locked", "shake");
      setTimeout(() => keyboardPanel.classList.remove("shake"), 300);
      return;
    }

    // â”€â”€ ìˆ˜ì‹í‚¤(Ctrl/Shift/Alt/Meta) ì²˜ë¦¬ â”€â”€
    if (["control", "alt", "shift", "meta"].includes(key)) {
      // Mac: Cmd(meta) â†’ controlë¡œ ë§¤í•‘
      const storeKey = (osMode === "mac" && key === "meta") ? "control"
                     : (osMode === "mac" && key === "control") ? "meta"
                     : key;
      pressedKeys.add(storeKey);

      // í™”ë©´ ë²„íŠ¼ active í‘œì‹œ
      const btn = document.querySelector(`.ds-key-btn[data-key='${storeKey}']`);
      if (btn) btn.classList.add("active");
      return; // ìˆ˜ì‹í‚¤ ë‹¨ë…ìœ¼ë¡œëŠ” ì •ë‹µ ì²´í¬ ì•ˆ í•¨
    }

    // âœ… Shift ì¡°í•© ì‹œ íŠ¹ìˆ˜ë¬¸ìë¥¼ ì›ë˜ í‚¤ë¡œ ë³€í™˜
    let normalizedKey = key;
    if (e.shiftKey) {
      const shiftMap = {
        '!': '1', '@': '2', '#': '3', '$': '4', '%': '5',
        '^': '6', '&': '7', '*': '8', '(': '9', ')': '0',
        '_': '-', '+': '=', '{': '[', '}': ']', '|': '\\',
        ':': ';', '"': "'", '<': ',', '>': '.', '?': '/'
      };
      normalizedKey = shiftMap[key] || key;
    }

    // â”€â”€ ì¼ë°˜ í‚¤ ì²˜ë¦¬ â”€â”€
    // ìˆ˜ì‹í‚¤ ìƒíƒœ ìœ ì§€í•˜ê³  ì¼ë°˜ í‚¤ë§Œ êµì²´
    const modifierSet = new Set(["control", "alt", "shift", "meta"]);
    const heldModifiers = Array.from(pressedKeys).filter(k => modifierSet.has(k));
    pressedKeys.clear();
    heldModifiers.forEach(k => pressedKeys.add(k));
    pressedKeys.add(normalizedKey);

    document.getElementById("ds-keyboard-display").textContent = normalizedKey.toUpperCase();
    checkAnswer();
  });

  // âœ… keyup: ìˆ˜ì‹í‚¤ ë–¼ë©´ ë²„íŠ¼ í•´ì œ (ì •ë‹µ ì²˜ë¦¬ ì¤‘ì´ ì•„ë‹ ë•Œ)
  document.addEventListener("keyup", e => {
    const key = e.key.toLowerCase();
    if (!["control", "alt", "shift", "meta"].includes(key)) return;

    const storeKey = (osMode === "mac" && key === "meta") ? "control"
                   : (osMode === "mac" && key === "control") ? "meta"
                   : key;

    if (!isInputLocked) {
      pressedKeys.delete(storeKey);
      const btn = document.querySelector(`.ds-key-btn[data-key='${storeKey}']`);
      if (btn) btn.classList.remove("active");
    }
  });

  document.getElementById("ds-os-mode").addEventListener("click", toggleOSMode);

  // ESCë¡œ íŒì—… ë‹«ê¸°
  document.addEventListener("keydown", (e) => {
    if (e.key === "Escape") closeVersionPopup();
  });
});
</script>
</body>
</html>
